{% extends 'base.html' %}
{% load static %}

{% block content %}
<style>
    /* Existing CSS retained for completeness */
    .product-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem 1rem;
        margin-top: 100px; /* Spacing for fixed navbar */
    }

    .gallery-section {
        background: #f9f9f9;
        border-radius: 20px;
        padding: 1rem;
    }

    .main-image {
        position: relative;
        margin-bottom: 1rem;
        overflow: hidden;
        cursor: zoom-in;
    }

    .main-image img {
        width: 100%;
        height: auto;
        max-height: 600px;
        object-fit: cover;
        border-radius: 12px;
        transition: transform 0.3s ease;
        transform-origin: center center;
    }

    .image-modal {
        display: none;
        position: fixed;
        z-index: 1000;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.9);
    }

    .modal-content {
        margin: auto;
        display: block;
        width: 90%;
        max-width: 1200px;
        max-height: 90vh;
        position: relative;
        top: 50%;
        transform: translateY(-50%);
    }

    .modal-content img {
        width: 100%;
        height: auto;
        object-fit: contain;
    }

    .close-modal {
        position: absolute;
        right: 20px;
        top: 20px;
        color: #fff;
        font-size: 30px;
        font-weight: bold;
        cursor: pointer;
    }

    .main-image.zoomed img {
        transform: scale(1.5);
    }

    .gallery-thumbs {
        max-height: 100px;
        display: flex;
        gap: 0.5rem;
    }

    .thumb {
        aspect-ratio: 1;
        cursor: pointer;
        transition: all 0.3s ease;
        border: 2px solid transparent;
        border-radius: 8px;
        overflow: hidden;
    }

    .thumb.active {
        border-color: #222;
    }

    .thumb img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .product-info {
        padding: 1rem;
    }

    .product-brand {
        text-transform: uppercase;
        letter-spacing: 2px;
        font-size: clamp(0.8rem, 2vw, 0.9rem);
        color: #666;
        margin-bottom: 0.5rem;
    }

    .product-name {
        font-size: clamp(1.5rem, 4vw, 2.5rem);
        font-weight: 500;
        margin-bottom: 1rem;
        color: #111;
    }

    .product-price {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 1.5rem;
        flex-wrap: wrap;
    }

    .product-price .discounted {
        font-size: 2rem;
        font-weight: 700;
        color: #ff4444;
    }

    .product-price .original {
        font-size: 1.4rem;
        color: #999;
        text-decoration: line-through;
        font-weight: 400;
    }

    .discount-badge {
        padding: 4px 8px;
        background: #ff4444;
        color: white;
        border-radius: 4px;
        font-size: 0.9rem;
        font-weight: 600;
    }

    .rating-star {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin-bottom: 1rem;
    }

    .rating-star i {
        font-size: 1.2rem;
        color: #ffd700;
    }

    .rating-star i.fa-star-o {
        color: #ccc;
    }

    .rating-star i.fa-star-half-o {
        color: #ffd700;
    }

    .rating-star span {
        color: #666;
        font-size: 0.9rem;
    }

    .product-description {
        font-size: 1rem;
        line-height: 1.6;
        color: #444;
        margin-bottom: 1.5rem;
    }

    .option-group {
        margin-bottom: 1.5rem;
        background: #f8f9fa;
        padding: 1.5rem;
        border-radius: 8px;
    }

    .option-label {
        font-size: 1rem;
        font-weight: 500;
        color: #333;
        margin-bottom: 1rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .color-options,
    .size-options {
        display: flex;
        gap: 0.8rem;
        flex-wrap: wrap;
    }

    .option-item {
        min-width: 45px;
        height: 45px;
        border: 2px solid #ddd;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        background: white;
    }

    .option-item:hover {
        border-color: #007bff;
        transform: translateY(-2px);
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .option-item input {
        position: absolute;
        opacity: 0;
    }

    .option-item span {
        font-size: 0.9rem;
        font-weight: 500;
        text-transform: uppercase;
        color: #444;
    }

    .option-item input:checked + span {
        background: #007bff;
        color: white;
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 6px;
    }

    .option-item.selected {
        border-color: #007bff;
        transform: translateY(-2px);
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .option-item.selected span {
        background: #007bff;
        color: white;
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 6px;
    }

    .quantity-selector {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        width: 120px;
    }

    .quantity-btn {
        width: 35px;
        height: 35px;
        background: #ff6200;
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 1.2rem;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .quantity-input {
        width: 50px;
        padding: 0.5rem;
        border: 2px solid #ddd;
        border-radius: 8px;
        text-align: center;
        font-size: 1rem;
        outline: none;
        background: white;
    }

    .quantity-input:focus {
        border-color: #007bff;
        box-shadow: 0 0 0 2px rgba(0,123,255,0.25);
    }

    .quantity-btn.plus {
        margin-right: 1rem;
    }

    .quantity-btn:hover {
        background: #e55a00;
        transform: translateY(-2px);
    }

    .quantity-btn:disabled {
        background: #ccc;
        cursor: not-allowed;
        transform: none;
    }

    .add-to-cart {
        width: 100%;
        padding: 1rem 2rem;
        background: #ff6200;
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 1.1rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 1px;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-top: 1rem;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .add-to-cart:hover {
        background: #e55a00;
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(0,0,0,0.15);
    }

    .add-to-cart:disabled {
        background: #ccc;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
    }

    .reviews-section {
        margin-top: 3rem;
        padding: 1rem;
        background: #f9f9f9;
        border-radius: 12px;
    }

    .review-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
        flex-wrap: wrap;
        gap: 1rem;
    }

    .review-card {
        background: white;
        padding: 1rem;
        border-radius: 8px;
        margin-bottom: 1rem;
    }

    .review-meta {
        display: flex;
        justify-content: space-between;
        margin-bottom: 0.5rem;
        font-size: clamp(0.8rem, 2vw, 0.9rem);
        color: #666;
        flex-wrap: wrap;
        gap: 0.5rem;
    }

    .review-content {
        line-height: 1.6;
        font-size: clamp(0.9rem, 2vw, 1rem);
    }

    .related-products {
        margin-top: 3rem;
    }

    .related-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
    }

    .related-header h3 {
        font-size: 1.5rem;
        font-weight: 600;
        color: #333;
    }

    .related-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 2rem;
        align-items: stretch;
        padding: 1rem;
    }

    .related-item {
        background: white;
        border-radius: 12px;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        height: 100%;
        position: relative;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        border: 2px solid transparent;
    }

    .related-item::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(45deg, rgba(255,98,0,0.1), rgba(255,98,0,0));
        opacity: 0;
        transition: opacity 0.4s ease;
        pointer-events: none;
        z-index: 1;
    }

    .related-item:hover {
        transform: translateY(-10px);
        box-shadow: 0 15px 30px rgba(0,0,0,0.15);
        border-color: #ff6200;
    }

    .related-item:hover::before {
        opacity: 1;
    }

    .related-image {
        position: relative;
        padding-top: 100%;
        overflow: hidden;
        flex-shrink: 0;
        background: #f8f9fa;
    }

    .related-image::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(0,0,0,0.1) 100%);
        opacity: 0;
        transition: opacity 0.4s ease;
    }

    .related-image img {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        backface-visibility: hidden;
    }

    .related-item:hover .related-image img {
        transform: scale(1.1) rotate(1deg);
    }

    .related-item:hover .related-image::after {
        opacity: 1;
    }

    .quick-view-btn {
        position: absolute;
        bottom: -50px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(255,98,0,0.9);
        color: white;
        padding: 8px 20px;
        border-radius: 20px;
        font-size: 0.9rem;
        font-weight: 500;
        opacity: 0;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        z-index: 2;
        text-decoration: none;
        white-space: nowrap;
    }

    .related-item:hover .quick-view-btn {
        bottom: 20px;
        opacity: 1;
    }

    .quick-view-btn:hover {
        background: rgba(255,98,0,1);
        transform: translateX(-50%) scale(1.05);
    }

    .related-info {
        padding: 1rem;
        flex-grow: 1;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        text-align: center;
    }

    .related-name {
        font-size: 1.1rem;
        font-weight: 500;
        color: #111;
        margin-bottom: 0.5rem;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        height: 2.4em;
        transition: color 0.4s ease;
    }

    .related-item:hover .related-name {
        color: #007bff;
    }

    .related-price {
        margin-bottom: 0.5rem;
    }

    .related-price .discounted {
        font-size: 1.1rem;
        font-weight: 500;
        color: red;
    }

    .related-price .original {
        font-size: 0.9rem;
        color: #999;
        text-decoration: line-through;
    }

    .discount-badge {
        position: absolute;
        top: 5px;
        right: 5px;
        background: #ff4444;
        color: white;
        padding: 0.25rem 0.5rem;
        border-radius: 4px;
        font-weight: 500;
        font-size: 0.9rem;
        z-index: 2;
    }

    .rate {
        display: flex;
        flex-direction: row-reverse;
        justify-content: flex-end;
    }
    .rate input {
        display: none;
    }
    .rate label {
        font-size: 1.5rem;
        color: #ccc;
        cursor: pointer;
    }
    .rate input:checked ~ label {
        color: #ffd700;
    }
    .rate label:hover,
    .rate label:hover ~ label {
        color: #ffd700;
    }

    .product-details-heading {
        font-size: clamp(1.8rem, 4vw, 2.2rem);
        font-weight: 600;
        color: #333;
        margin-bottom: 1.5rem;
        text-align: center;
        text-transform: capitalize;
    }

    .tabs-section {
        margin-top: 2rem;
        padding: 1rem;
        background: #f9f9f9;
        border-radius: 12px;
    }

    .tabs-nav {
        display: flex;
        border-bottom: 2px solid #ddd;
        margin-bottom: 1.5rem;
    }

    .tab-link {
        padding: 0.5rem 1.5rem;
        font-size: 1.1rem;
        font-weight: 500;
        color: #333;
        cursor: pointer;
        transition: all 0.3s ease;
        border-bottom: 3px solid transparent;
    }

    .tab-link.active {
        color: #ff6200;
        border-bottom: 3px solid #ff6200;
    }

    .tab-link:hover {
        color: #e55a00;
    }

    .tab-content {
        display: none;
        padding: 1rem;
        font-size: 1rem;
        line-height: 1.6;
        color: #444;
    }

    .tab-content.active {
        display: block;
    }

    .tab-content h4 {
        font-size: 1.2rem;
        font-weight: 600;
        margin-bottom: 1rem;
        color: #333;
    }

    .tab-content ul {
        list-style-type: disc;
        margin-left: 1.5rem;
        margin-bottom: 1rem;
    }

    .tab-content ul li {
        margin-bottom: 0.5rem;
    }

    .size-chart-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 1rem;
    }

    .size-chart-table th,
    .size-chart-table td {
        border: 1px solid #ddd;
        padding: 0.5rem;
        text-align: center;
        font-size: 0.9rem;
    }

    .size-chart-table th {
        background: #f8f9fa;
        font-weight: 600;
        color: #333;
    }

    .size-chart-link {
        color: #007bff;
        text-decoration: none;
        font-weight: 500;
    }

    .size-chart-link:hover {
        text-decoration: underline;
    }

    @media (max-width: 768px) {
        .product-container {
            padding: 0.5rem;
            margin-top: 80px;
        }

        .product-info {
            margin-top: 1rem;
        }

        .product-price {
            flex-direction: column;
            align-items: flex-start;
            gap: 5px;
        }

        .product-price .discounted {
            font-size: 1.6rem;
        }

        .product-price .original {
            font-size: 1.1rem;
        }

        .product-details-heading {
            font-size: clamp(1.5rem, 3.5vw, 1.8rem);
        }

        .quantity-selector {
            width: 100px;
        }

        .quantity-btn {
            width: 30px;
            height: 30px;
            font-size: 1rem;
        }

        .quantity-btn.plus {
            margin-right: 0.8rem;
        }

        .quantity-input {
            width: 40px;
            font-size: 0.9rem;
        }

        .tabs-nav {
            flex-direction: column;
            align-items: flex-start;
        }

        .tab-link {
            padding: 0.5rem 1rem;
            font-size: 1rem;
        }
    }
</style>

<div class="product-container">
    <!-- Product Details Heading -->
    <h2 class="product-details-heading">Product Details: {{ single_product.name|default:'Unnamed Product' }}</h2>

    <!-- Category Navigation -->


    <div class="row">
        <!-- Image Modal -->
        <div id="imageModal" class="image-modal">
            <span class="close-modal">&times;</span>
            <div class="modal-content">
                <img id="modalImg" src="" alt="Modal Image">
            </div>
        </div>

        <!-- Gallery Section -->
        <div class="col-lg-7">
            <div class="gallery-section">
                <div class="main-image" id="mainImage">
                    <img src="{{ single_product.images.url|default:'/static/images/placeholder.jpg' }}" id="mainImg" alt="{{ single_product.name|default:'Product Image' }}">
                    {% if single_product.discounted_price_annotated != single_product.price %}
                        <span class="discount-badge">-{{ single_product.discount_percentage|default:'0' }}% OFF</span>
                    {% endif %}
                </div>
                <div class="gallery-thumbs">
                    <div class="thumb active">
                        <img src="{{ single_product.images.url|default:'/static/images/placeholder.jpg' }}" onclick="changeImage(this)" alt="Thumbnail">
                    </div>
                    {% for image in product_gallery %}
                        <div class="thumb">
                            <img src="{{ image.image.url|default:'/static/images/placeholder.jpg' }}" onclick="changeImage(this)" alt="Thumbnail">
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- Product Info -->
        <div class="col-lg-5">
            <div class="product-info">
                <form action="{% url 'add_cart' single_product.id %}" method="POST">
                    {% csrf_token %}
                    <div class="product-brand">
                        {% if single_product.category %}
                            <a href="{% url 'products_by_category' single_product.category.slug %}">
                                {{ single_product.category }}
                            </a>
                        {% elif single_product.brand %}
                            <a href="{% url 'products_by_brand' single_product.brand.slug %}">
                                {{ single_product.brand }}
                            </a>
                        {% else %}
                            <span>Uncategorized</span>
                        {% endif %}
                    </div>
                    <h1 class="product-name">{{ single_product.name|default:'Unnamed Product' }}</h1>

                    <div class="product-price">
                        {% if single_product.discounted_price_annotated != single_product.price %}
                            <span class="discounted">TK {{ single_product.discounted_price_annotated|floatformat:2 }}</span>
                            <span class="original">TK {{ single_product.price|floatformat:2 }}</span>

                        {% else %}
                            <span class="discounted">TK {{ single_product.price|floatformat:2 }}</span>
                        {% endif %}
                    </div>

                    <div class="rating-star mb-3">
                        {% for i in "12345" %}
                            <i class="fa fa-star{% if forloop.counter > single_product.averageReviews %}-o{% elif single_product.averageReviews > forloop.counter|add:'-0.5' and single_product.averageReviews < forloop.counter %}-half-o{% endif %}"></i>
                        {% endfor %}
                        <span>({{ single_product.countReview }} Reviews)</span>
                    </div>

                    <p class="product-description mb-4">{{ single_product.description|default:"No description available" }}</p>

                    <div class="option-group">
                        <div class="option-label">Select Color</div>
                        <div class="color-options">
                            {% for color in single_product.variation_set.colors %}
                                <label class="option-item">
                                    <input type="radio" name="radio_color" value="{{ color.variation_value|lower }}" required>
                                    <span>{{ color.variation_value|capfirst }}</span>
                                </label>
                            {% empty %}
                                <p>No colors available</p>
                            {% endfor %}
                        </div>
                    </div>

                    <div class="option-group">
                        <div class="option-label">Select Size</div>
                        <div class="size-options">
                            {% for size in single_product.variation_set.sizes %}
                                <label class="option-item">
                                    <input type="radio" name="radio_size" value="{{ size.variation_value|lower }}" required>
                                    <span>{{ size.variation_value|upper }}</span>
                                </label>
                            {% empty %}
                                <p>No sizes available</p>
                            {% endfor %}
                        </div>
                    </div>

                    <div class="option-group">
                        <div class="option-label">Select Quantity</div>
                        <div class="d-flex align-items-center gap-3">
                            <div class="quantity-selector">
                                <button type="button" class="quantity-btn" onclick="decrementQuantity(this)" data-min="1">-</button>
                                <input type="number" class="quantity-input" name="quantity" value="1" min="1" max="{{ single_product.stock|default:'100' }}" readonly>
                                <button type="button" class="quantity-btn plus" onclick="incrementQuantity(this)" data-max="{{ single_product.stock|default:'100' }}">+</button>
                            </div>
                            {% if single_product.stock <= 0 %}
                                <small class="text-danger">Out of Stock</small>
                            {% else %}
                                <small class="text-success">{{ single_product.stock|default:'100' }} items available</small>
                            {% endif %}
                        </div>
                    </div>

                    {% if single_product.stock <= 0 %}
                        <button class="add-to-cart" disabled>Out of Stock</button>
                    {% else %}
                        <button type="submit" class="add-to-cart">
                            <i class="fas fa-shopping-cart me-2"></i>
                            Add to Cart
                        </button>
                    {% endif %}
                </form>
            </div>
        </div>
    </div>

    <!-- Tabs Section -->
    <div class="tabs-section">
        <div class="tabs-nav">
            <div class="tab-link active" data-tab="description">Description</div>
            <div class="tab-link" data-tab="terms">Terms and Conditions</div>
            <div class="tab-link" data-tab="size-chart">Size Chart</div>
        </div>

        <!-- Description Tab -->
        <div class="tab-content active" id="description">
            <h4>Description</h4>
            <p>{{ single_product.description|default:"No description available" }}</p>
            <h4>Style Tips</h4>
            <p>
                {{ single_product.style_tips|default:'Pair these casual sneakers with a brown long-sleeve shirt and white chinos for a classic and clean look. Add a watch and a leather strap to finish off the outfit and give it a fresh, modern twist—perfect for any casual outing or weekend get-together!' }}
            </p>
        </div>

        <!-- Terms and Conditions Tab -->
        <div class="tab-content" id="terms">
            <h4>Terms and Conditions</h4>
            <div class="section">
                <h2>1. GENERAL PROVISIONS</h2>
                <ol>
                    <li>1.1. This User Agreement (hereinafter - the Agreement) refers to the website of the AF Emporium Ltd located at ariyan footwear ltd, and all relevant sites linked to www.ariyanfootwear.com.</li>
                    <li>1.2. The site of the Bay Emporium Ltd (hereinafter referred to as the Site) is the property of ariyan.</li>
                    <li>1.3. This Agreement governs the relationship between the Site Administration of the ariyan footwear Ltd (hereinafter referred to as the Site Administration) and the User of this Site.</li>
                    <li>1.4. The site administration reserves the right at any time to change, add or delete paragraphs of this Agreement without notifying the User.</li>
                    <li>1.5. Continued use of the Site by the User means acceptance of the Agreement and changes made to this Agreement.</li>
                    <li>1.6. The user is personally responsible for checking this Agreement for changes in it.</li>
                </ol>
            </div>
            <div class="section">
                <h2>2. DEFINITIONS OF TERMS</h2>
                <ol>
                    <li>2.1. The following terms have the following meanings for the purposes of this Agreement:
                        <ol>
                            <li>2.1.1 This is an ecommerce store located on the domain name “www.ariyanfootwear.com”, which operates through an Internet resource and related services.</li>
                            <li>2.1.2. “amarbay.com” - a site containing information about the Goods and allowing you to select, order and (or) purchase the Goods along with delivery facilities.</li>
                            <li>2.1.3. Administration of the site of the “www.ariyanfootwear.com” – is authorized by the employees on behalf of Bay Emporium Ltd.</li>
                            <li>2.1.4. A person who has access to the site through the Internet and uses the site is the user of “amarbay.com”.</li>
                            <li>2.1.5. The content of the “www.ariyanfootwear.com” is - the protected results of intellectual activity, including texts of literary works, their names, preface, annotations, articles, illustrations, covers, musical works with or without text, graphic, textual, photographic, derivative, composite and other works, user interfaces, visual interfaces, trademark names, logos, computer programs, databases, as well as design, structure, choice, coordination, appearance and the location of the Content, which is part of the site and other intellectual property collectively and / or individually contained on the Web Store.</li>
                        </ol>
                    </li>
                </ol>
            </div>
            <div class="section">
                <h2>3. SUBJECT OF THE AGREEMENT</h2>
                <ol>
                    <li>3.1. The subject of this Agreement is the provision to the User of the “amarbay.com” of access to the Goods and services provided on the Website. “www.ariyanfootwear.com” provides the User with the following types of service (services):
                        Access to Shoe and Shoe Accessories shopping via online with contents, with the right to purchase (Online), view product info and ask support. Access to search and navigation tools of the online store. providing the User with the opportunity to post messages, comments, user reviews, rate the content of the online store.</li>
                    <li>3.2. Access to the “amarbay.com” is provided free of charge.</li>
                    <li>3.3. This Agreement is a public offer. When accessing the Site, the User is considered to have acceded to this Agreement.</li>
                    <li>3.4. The use of materials and services of the Site is governed by the applicable laws of the Country</li>
                </ol>
            </div>
            <div class="section">
                <h2>4. RIGHTS AND OBLIGATIONS OF THE PARTIES</h2>
                <ol>
                    <li>4.1. The site administration has the right:
                        <ol>
                            <li>4.1.1. Change the rules for using the Site, as well as change the content of this Site. Changes come into force from the moment the new version of the Agreement is published on the Site.</li>
                            <li>4.1.2. Restrict access to the Site in case the User violates the terms of this Agreement.</li>
                        </ol>
                    </li>
                    <li>4.2. The user has the right to:
                        <ol>
                            <li>4.2.1. Get access to the use of the Site after compliance with the registration requirements.</li>
                            <li>4.2.2. Use all the services available on the Site, as well as purchase any Goods offered on the Site.</li>
                            <li>4.2.3. Use the Site exclusively for the purposes and in the manner provided for by the Agreement and not prohibited by the legislation of the Republic of Bangladesh.</li>
                        </ol>
                    </li>
                    <li>4.3. The user of the Site agrees:
                        <ol>
                            <li>4.3.1. Provide at the request of the Site Administration additional information that is directly related to the services provided on this Site.</li>
                            <li>4.3.2. Observe the property and non-property rights of authors and other copyright holders when using the Site.</li>
                            <li>4.3.3. Do not take actions that may be considered as violating the normal operation of the Site.</li>
                            <li>4.3.4. Do not disseminate using the Site any confidential and protected by the legislation of the Country information about individuals or legal entities.</li>
                            <li>4.3.5. Avoid any actions that may result in the violation of the confidentiality of information protected by the legislation of the Country Law.</li>
                            <li>4.3.6. Do not use the Site to disseminate advertising information, except with the consent of the Site Administration.</li>
                            <li>4.3.7. Do not use the services of the website of the “www.ariyanfootwear.com” store in order to:
                                <ol>
                                    <li>4.3.7.1. Uploading content that is illegal violates any rights of third parties; promotes violence, cruelty, hatred and (or) discrimination, on racial national, gender, religious, social grounds; contains inaccurate information and (or) insults addressed to specific individuals, organizations, authorities.</li>
                                    <li>4.3.7.2. Incentives to commit unlawful acts, as well as assistance to persons whose actions are aimed at violating restrictions and prohibitions in force in the territory of the Country.</li>
                                    <li>4.3.7.3. Violations of the rights of minors and (or) harm to them in any form.</li>
                                    <li>4.3.7.4. Infringement of the rights of minorities.</li>
                                    <li>4.3.7.5. Presenting yourself for another person or representative of an organization and / or community without sufficient rights to do so, including for employees of “www.ariyanfootwear.com”.</li>
                                    <li>4.3.7.6. Misleading regarding the properties and characteristics of any Product from the catalog of the “amarbay.com” posted on the Site.</li>
                                    <li>4.3.7.7. Incorrect comparison of the Goods, as well as the formation of a negative attitude towards persons (not) using certain Goods, or the conviction of such persons.</li>
                                </ol>
                            </li>
                        </ol>
                    </li>
                    <li>4.4. The user is prohibited from:
                        <ol>
                            <li>4.4.1. Use any devices, programs, procedures, algorithms and methods, automatic devices or equivalent manual processes to access, acquire, copy or track the content of the Site of this Online Store;</li>
                            <li>4.4.2. Disrupt the proper functioning of the Site;</li>
                            <li>4.4.3. By any means bypass the navigation structure of the Site to obtain or attempt to obtain any information, documents or materials by any means that are not specifically provided by the services of this Site;</li>
                            <li>4.4.4. Unauthorized access to the functions of the Site, any other systems or networks related to this Site, as well as to any services offered on the Site;</li>
                            <li>4.4.5. Violate the security system or authentication on the Site or on any network related to the Site.</li>
                            <li>4.4.6. Perform a reverse search, track or try to track any information about any other User of the Site.</li>
                            <li>4.4.7. Use the Site and its Content for any purposes prohibited by the legislation of Country, as well as incite any illegal activity or other activity that violates the rights of the “amarbay.com” or other persons.</li>
                        </ol>
                    </li>
                </ol>
            </div>
            <div class="section">
                <h2>5. USE OF ARIYANFOOTWEAR SITE</h2>
                <ol>
                    <li>5.1. The Site and the Content included in the Site are owned and operated by the Site Administration.</li>
                    <li>5.2. The content of the Site cannot be copied, published, reproduced, transmitted or distributed in any way, as well as posted on the global Internet without the prior written consent of the Site Administration.</li>
                    <li>5.3. The content of the Site is protected by copyright, trademark law, and other intellectual property rights and unfair competition laws.</li>
                    <li>5.4. The purchase of goods offered on the Site may require the creation of a User account.</li>
                    <li>5.5. The User is personally responsible for maintaining the confidentiality of account information, including the password, as well as for all activities without exception that are carried out on behalf of the User of the account.</li>
                    <li>5.6. The user must immediately notify the Site Administration of the unauthorized use of his account or password or any other violation of the security system.</li>
                    <li>5.7. The site administration has the right to unilaterally cancel the User’s account if it has not been used for more than 3 calendar months in a row without notifying the User.</li>
                    <li>5.8. This Agreement applies to all additional terms and conditions on the purchase of the Goods and the provision of services provided on the Site.</li>
                    <li>5.9. The information posted on the Site should not be construed as a change to this Agreement.</li>
                    <li>5.10. The site administration has the right at any time without notice to the User to make changes to the list of Goods and services offered on the Website, and (or) the prices applicable to such Goods for their sale and (or) the services provided by the Online Store.</li>
                    <li>5.11. The documents referred to in paragraphs 5.11.1 - 5.11.4 of this Agreement shall be regulated in the relevant part and shall apply to the use of the Site by the User. The following documents are included in this Agreement:
                        <ol>
                            <li>5.11.1. Privacy policy;</li>
                            <li>5.11.2. Contract for the sale of goods remotely;</li>
                            <li>5.11.3. Application for placing an order;</li>
                            <li>5.11.4. Suggestions and comments.</li>
                        </ol>
                    </li>
                    <li>5.12. Any of the documents listed in clause 5.11. of this Agreement may be subject to updating. Changes come into force from the moment they are published on the Site.</li>
                </ol>
            </div>
            <div class="section">
                <h2>6. RESPONSIBILITY</h2>
                <ol>
                    <li>6.1. Any losses that the User may suffer in the event of intentional or reckless violation of any provision of this Agreement, as well as due to unauthorized access to the communications of another User, are not reimbursed by the Site Administration.</li>
                    <li>6.2. The site administration is not responsible for:
                        <ol>
                            <li>6.2.1. Delays or malfunctions in the process of performing an operation resulting from force majeure, as well as any case of malfunctions in telecommunication, computer, electrical and other related systems.</li>
                            <li>6.2.2. Actions of transfer systems, banks, payment systems and for delays associated with their work.</li>
                            <li>6.2.3. The proper functioning of the Site, if the User does not have the necessary technical means for its use, and also does not bear any obligations to provide users with such means.</li>
                        </ol>
                    </li>
                </ol>
            </div>
            <div class="section">
                <h2>7. VIOLATION OF THE TERMS AND CONDITIONS OF THE USER AGREEMENT</h2>
                <ol>
                    <li>7.1. The site administration has the right to disclose any information collected about the User of this Site, if the disclosure is necessary in connection with an investigation or complaint regarding the misuse of the Site or to establish (identify) the User who may violate or interfere with the rights of the Site Administration or the rights of other Site Users.</li>
                    <li>7.2. The site administration has the right to disclose any information about the User that it considers necessary to comply with the provisions of applicable law or court decisions, ensure compliance with the terms of this Agreement, protect the rights or safety of “amarbay.com”, Users.</li>
                    <li>7.3. The site administration has the right to disclose information about the User if the current legislation of the Country requires or allows such disclosure.</li>
                    <li>7.4. The site administration has the right to terminate and (or) block access to the Site without prior notice to the User if the User has violated this Agreement or the terms of use of the Site contained in other documents, as well as in case of termination of the Site or due to a technical problem or other problem.</li>
                    <li>7.5. The site administration is not responsible to the User or third parties for terminating access to the Site in case the User violates any provision of this Agreement or other document containing the conditions for using the Site.</li>
                </ol>
            </div>
            <div class="section">
                <h2>8. SETTLEMENT OF DISPUTES</h2>
                <ol>
                    <li>8.1. In the event of any disagreement or disputes between the Parties to this Agreement, a prerequisite before applying to the court is a claim (a written proposal for the voluntary settlement of the dispute).</li>
                    <li>8.2. The recipient of the claim, within 30 calendar days from the date of its receipt, shall notify the claimant in writing of the results of the consideration of the claim.</li>
                    <li>8.3. If it is not possible to resolve the dispute on a voluntary basis, any of the Parties is entitled to apply to the court for the protection of their rights that are granted to them by the current legislation of the Country.</li>
                </ol>
            </div>
            <div class="section">
                <h2>9. ADDITIONAL TERMS</h2>
                <ol>
                    <li>9.1. The site administration does not accept counter offers from the User regarding changes to this User Agreement.</li>
                    <li>9.2. User reviews posted on the Site are not confidential information and can be used by the Site Administration without restrictions.</li>
                </ol>
            </div>
        </div>

        <!-- Size Chart Tab -->
        <div class="tab-content" id="size-chart">
            <main class="container mt-5 mb-5">
                <h2 class="text-warning mb-4">Size Charts</h2>
                <div class="card p-4">
                    <h5 class="text-uppercase font-weight-bold">Men's Footwear</h5>
                    <table class="table table-bordered">
                        <thead>
                            <tr><th>US</th><th>EU</th><th>UK</th></tr>
                        </thead>
                        <tbody>
                            <tr><td>7</td><td>40</td><td>6</td></tr>
                            <tr><td>8</td><td>41</td><td>7</td></tr>
                            <tr><td>9</td><td>42</td><td>8</td></tr>
                        </tbody>
                    </table>
                    <h5 class="text-uppercase font-weight-bold mt-4">Women's Footwear</h5>
                    <table class="table table-bordered">
                        <thead>
                            <tr><th>US</th><th>EU</th><th>UK</th></tr>
                        </thead>
                        <tbody>
                            <tr><td>5</td><td>35</td><td>3</td></tr>
                            <tr><td>6</td><td>36</td><td>4</td></tr>
                            <tr><td>7</td><td>37</td><td>5</td></tr>
                        </tbody>
                    </table>
                </div>
            </main>
        </div>
    </div>

    <!-- Customer Reviews Section -->
    <div class="reviews-section">
        <form action="{% url 'submit_review' single_product.id %}" method="POST">
            {% csrf_token %}
            <h4>Write Your Review</h4>
            <div class="form-group">
                <label>Rating</label>
                <div class="rate">
                    {% for i in "54321" %}
                        <input type="radio" name="rating" id="rating{{ i }}" value="{{ i }}" required>
                        <label for="rating{{ i }}" title="{{ i }} stars"></label>
                    {% endfor %}
                </div>
                <input type="text" name="subject" placeholder="Review Title" class="form-control mt-2">
                <textarea name="review" rows="4" placeholder="Your review" class="form-control mt-2"></textarea>
                <br>
                {% if user.is_authenticated %}
                    {% if orderproduct %}
                        <button type="submit" class="btn btn-primary">Submit Review</button>
                    {% else %}
                        <p>You must purchase this product to post a review.</p>
                    {% endif %}
                {% else %}
                    <p>You must be logged in to post a review. <a href="{% url 'login' %}">Login Now</a></p>
                {% endif %}
            </div>
        </form>

        <br>
        <header class="section-heading">
            <h3>Customer Reviews</h3>
            <div class="rating-star">
                {% for i in "12345" %}
                    <i class="fa fa-star{% if forloop.counter > single_product.averageReviews %}-o{% elif single_product.averageReviews > forloop.counter|add:'-0.5' and single_product.averageReviews < forloop.counter %}-half-o{% endif %}"></i>
                {% endfor %}
                <span>{{ single_product.countReview }} Reviews</span>
            </div>
        </header>
        {% for review in reviews %}
            <article class="review-card">
                <div class="review-meta">
                    <span><strong>{{ review.user.first_name|default:'Anonymous' }}</strong></span>
                    <span>{{ review.updated_at|date:"M d, Y" }}</span>
                </div>
                <h5>{{ review.subject|default:'No Title' }}</h5>
                <div class="review-content">{{ review.review|default:'No review provided' }}</div>
            </article>
        {% empty %}
            <p>No reviews yet.</p>
        {% endfor %}
    </div>

    <!-- Related Products -->
    <div class="related-products">
        <div class="related-header">
            <h3>You May Also Like</h3>
            {% if single_product.category %}
                <a href="{% url 'products_by_category' single_product.category.slug %}" class="btn btn-outline-dark">
                    View All in {{ single_product.category.name }}
                </a>
            {% elif single_product.brand %}
                <a href="{% url 'products_by_brand' single_product.brand.slug %}" class="btn btn-outline-dark">
                    View All in {{ single_product.brand.name }}
                </a>
            {% endif %}
        </div>
        <div class="related-grid" id="relatedProductsGrid">
            {% for product in related_products %}
                <div class="related-item">
                    <a href="{% url 'product_detail' product.category.slug product.slug %}" data-product-id="{{ product.id }}" data-product-slug="{{ product.slug }}" data-category-slug="{{ product.category.slug }}" class="text-decoration-none">
                        <div class="related-image">
                            <img src="{{ product.images.url|default:'/static/images/placeholder.jpg' }}" alt="{{ product.name|default:'Product Image' }}">
                            {% if product.discounted_price_annotated != product.price %}
                                <span class="discount-badge">-{{ product.discount_percentage|default:'50' }}%</span>
                            {% endif %}
                        </div>
                        <div class="related-info">
                            <div class="related-name">{{ product.name|default:'Unnamed Product' }}</div>
                            <div class="related-price">
                                {% if product.discounted_price_annotated != product.price %}
                                    <span class="discounted">TK {{ product.discounted_price_annotated|floatformat:2 }}</span>
                                    <span class="original">TK {{ product.price|floatformat:2 }}</span>
                                {% else %}
                                    <span class="discounted">TK {{ product.price|floatformat:2 }}</span>
                                {% endif %}
                            </div>
                        </div>
                    </a>
                </div>
            {% empty %}
                <p>No related products available.</p>
            {% endfor %}
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const modal = document.getElementById('imageModal');
        const modalImg = document.getElementById('modalImg');
        const closeModal = document.querySelector('.close-modal');
        const mainImg = document.getElementById('mainImg');
        const mainImageContainer = document.getElementById('mainImage');

        function changeImage(element) {
            mainImg.src = element.src;
            document.querySelectorAll('.thumb').forEach(thumb => {
                thumb.classList.remove('active');
            });
            element.parentElement.classList.add('active');
            mainImageContainer.classList.remove('zoomed');
            mainImg.style.transformOrigin = 'center center';
        }

        if (mainImg) {
            mainImg.addEventListener('click', function() {
                modal.style.display = "block";
                modalImg.src = this.src;
            });
        }

        document.querySelectorAll('.thumb img').forEach(img => {
            img.addEventListener('click', function() {
                changeImage(this);
            });
        });

        if (closeModal) {
            closeModal.addEventListener('click', () => {
                modal.style.display = "none";
            });
        }

        if (modal) {
            modal.addEventListener('click', (event) => {
                if (event.target === modal) {
                    modal.style.display = "none";
                }
            });
        }

        document.addEventListener('keydown', (event) => {
            if (event.key === "Escape" && modal) {
                modal.style.display = "none";
            }
        });

        if (mainImageContainer && mainImg) {
            mainImageContainer.addEventListener('mousemove', function(e) {
                const rect = mainImg.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                const xPercent = (x / rect.width) * 100;
                const yPercent = (y / rect.height) * 100;

                this.classList.add('zoomed');
                mainImg.style.transformOrigin = `${xPercent}% ${yPercent}%`;
            });

            mainImageContainer.addEventListener('mouseout', function() {
                this.classList.remove('zoomed');
                mainImg.style.transformOrigin = 'center center';
            });
        }

        // Quantity selector functionality
        function incrementQuantity(button) {
            const input = button.parentElement.querySelector('.quantity-input');
            const max = parseInt(input.getAttribute('max')) || 100;
            let value = parseInt(input.value) || 1;
            if (value < max) {
                input.value = value + 1;
                updateButtonStates(input);
            }
        }

        function decrementQuantity(button) {
            const input = button.parentElement.querySelector('.quantity-input');
            const min = parseInt(input.getAttribute('min')) || 1;
            let value = parseInt(input.value) || 1;
            if (value > min) {
                input.value = value - 1;
                updateButtonStates(input);
            }
        }

        function updateButtonStates(input) {
            const min = parseInt(input.getAttribute('min')) || 1;
            const max = parseInt(input.getAttribute('max')) || 100;
            const value = parseInt(input.value) || 1;
            const decrementBtn = input.parentElement.querySelector('.quantity-btn:first-child');
            const incrementBtn = input.parentElement.querySelector('.quantity-btn:last-child');

            decrementBtn.disabled = value <= min;
            incrementBtn.disabled = value >= max;
        }

        // Initialize button states
        document.querySelectorAll('.quantity-input').forEach(input => {
            updateButtonStates(input);
        });

        // Tab functionality
        document.querySelectorAll('.tab-link').forEach(tab => {
            tab.addEventListener('click', function() {
                document.querySelectorAll('.tab-link').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

                this.classList.add('active');
                document.getElementById(this.getAttribute('data-tab')).classList.add('active');
            });
        });

        window.changeImage = changeImage;
        window.incrementQuantity = incrementQuantity;
        window.decrementQuantity = decrementQuantity;
    });
</script>
{% endblock %}